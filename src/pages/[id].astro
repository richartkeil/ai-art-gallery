---
import Layout from "../layouts/Layout.astro";
import { getImage } from "@astrojs/image";

const creations: {
    id: string;
    image: astroHTML.JSX.ImgHTMLAttributes;
    description: string;
    source: string;
}[] = [];
const rawCreations = (await Astro.glob('../assets/creations/creations.json'))[0].default;
const imageFiles = await Astro.glob('../assets/creations/images/*.webp');
for (const creation of rawCreations) {
    const image = imageFiles.find(f => f.default.src.includes(creation.filename));
    creations.push({
        id: creation.id,
        image: await getImage({ src: image!.default.src, format: 'webp', width: 1024, height: 1024 }),
        description: creation.description,
        source: creation.sourceUrl,
    });
}

const { id } = Astro.params;
const creation = creations.find(c => c.id === id)!;

export async function getStaticPaths() {
    const rawCreations = (await Astro.glob('../assets/creations/creations.json'))[0].default;
    return rawCreations.map((creation: any) => ({ params: { id: creation.id } }));
}
---

<Layout title="AI Art Gallery">
    <main>
        <div class="w-full md:w-5/12 m-auto p-4 text-center">
            <div class="mb-4 text-left">
                <a href="/">‚Üê</a>
            </div>
            <img src={creation.image.src} class="w-full rounded" />
            <p class="p-4 font-serif text-slate-600">{creation.description}</p>
            <a href={creation.source} target="_blank">
                <button
                    class="rounded-full border-2 border-slate-600 px-4 py-1 font-serif text-center hover:bg-slate-600 hover:text-white transition-colors">
                    Source
                </button>
            </a>
        </div>
    </main>
</Layout>